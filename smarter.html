<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smarter Than a Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #020617;
            color: #e2e8f0;
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
        }

        h1, h2, h3, .orbitron { font-family: 'Orbitron', sans-serif; }

        /* Canvas Background */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.4;
            pointer-events: none;
        }

        /* Game Container Container */
        #game-mount {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #38bdf8; border-radius: 4px; }

        /* Animations */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        .scan-line {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 10vh;
            background: linear-gradient(to bottom, transparent, rgba(34, 211, 238, 0.2), transparent);
            animation: scanline 4s linear infinite;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .floating { animation: float 3s ease-in-out infinite; }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(34, 211, 238, 0.4); }
            50% { box-shadow: 0 0 30px rgba(34, 211, 238, 0.8); }
        }

        /* UI Elements */
        .glass-panel {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(56, 189, 248, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .btn-cyber {
            background: linear-gradient(45deg, #0ea5e9, #2563eb);
            border: 2px solid #38bdf8;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-cyber:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.6);
        }
        .btn-cyber:active { transform: scale(0.95); }
        .btn-cyber:disabled {
            background: #1e293b; border-color: #334155; color: #64748b; cursor: not-allowed; transform: none; box-shadow: none;
        }

        /* Jeopardy Board Styles */
        .chatbot-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            width: 100%; max-width: 1200px; margin: 0 auto;
        }
        .cat-header {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            padding: 15px 5px; text-align: center; font-weight: bold;
            border: 2px solid #334155; border-radius: 8px; color: #22d3ee;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); min-height: 80px;
        }
        .point-btn {
            background: #1e293b; border: 2px solid #334155; color: #facc15;
            font-size: 1.5rem; padding: 20px 0; border-radius: 8px; cursor: pointer;
            transition: all 0.2s; text-shadow: 0 0 5px rgba(250, 204, 21, 0.5);
        }
        .point-btn:hover:not(:disabled) {
            background: #334155; transform: scale(1.05); border-color: #facc15;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.3); z-index: 10;
        }
        .point-btn:disabled {
            background: transparent; color: transparent; border-color: #0f172a; cursor: default; text-shadow: none; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Category Select Grid */
        .cat-select-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px;
            width: 100%; max-width: 1000px; max-height: 50vh; overflow-y: auto; padding: 10px;
        }
        .cat-card {
            background: #1e293b; border: 2px solid #334155; border-radius: 8px;
            padding: 15px; cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; text-align: center; position: relative;
        }
        .cat-card:hover { border-color: #22d3ee; background: #334155; }
        .cat-card.selected { border-color: #facc15; background: #334155; box-shadow: 0 0 15px rgba(250, 204, 21, 0.2); }
        .cat-card i { font-size: 2rem; color: #94a3b8; margin-bottom: 10px; }
        .cat-card.selected i { color: #facc15; }
        .check-icon { position: absolute; top: 5px; right: 5px; color: #facc15; opacity: 0; }
        .cat-card.selected .check-icon { opacity: 1; }
    </style>
</head>
<body>

    <!-- Background Animation (Replaces video to remain self-contained) -->
    <canvas id="bg-canvas"></canvas>
    <div class="scan-line"></div>

    <div id="game-mount"></div>

<script>
/**
 * TRIVIA DATA
 */
const CHATBOT_TRIVIA_DATA = {
    'llm_basics': { name: 'LLM Basics', icon: 'fa-brain', questions: [
        { points: 100, q: "What does 'LLM' stand for?", options: ["Large Learning Machine", "Large Language Model", "Long Linear Matrix", "Low Latency Memory"], answer: 1 },
        { points: 200, q: "Which of these is a popular transformer-based architecture?", options: ["GPT", "CNN", "RNN", "LSTM"], answer: 0 },
        { points: 300, q: "What is the process called when an LLM generates text token by token?", options: ["Training", "Fine-tuning", "Inference", "Backpropagation"], answer: 2 },
        { points: 400, q: "What is a 'token' in the context of LLMs?", options: ["A cryptocurrency coin", "A unit of text (part of a word)", "A user session ID", "A hardware accelerator"], answer: 1 },
        { points: 500, q: "What technique allows an LLM to follow specific instructions better after pre-training?", options: ["Reinforcement Learning from Human Feedback (RLHF)", "Supervised Pre-training", "Unsupervised Clustering", "Gradient Descent"], answer: 0 }
    ]},
    'ai_history': { name: 'AI History', icon: 'fa-history', questions: [
        { points: 100, q: "Who is considered the father of theoretical computer science and AI?", options: ["Alan Turing", "Charles Babbage", "Ada Lovelace", "John von Neumann"], answer: 0 },
        { points: 200, q: "What was the name of the IBM computer that defeated Garry Kasparov at chess?", options: ["Deep Blue", "Watson", "AlphaGo", "HAL 9000"], answer: 0 },
        { points: 300, q: "Which AI program defeated the world champion at the game of Go in 2016?", options: ["AlphaGo", "DeepMind", "Stockfish", "GPT-3"], answer: 0 },
        { points: 400, q: "What year was the term 'Artificial Intelligence' coined?", options: ["1956", "1945", "1969", "1980"], answer: 0 },
        { points: 500, q: "Which chatbot was created in 1966 to simulate a Rogerian psychotherapist?", options: ["ELIZA", "PARRY", "A.L.I.C.E.", "Siri"], answer: 0 }
    ]},
    'pop_culture': { name: 'Pop Culture AI', icon: 'fa-film', questions: [
        { points: 100, q: "What is the name of the AI in the 'Halo' video game series?", options: ["Cortana", "Siri", "Alexa", "GLaDOS"], answer: 0 },
        { points: 200, q: "Which movie features an AI named HAL 9000?", options: ["2001: A Space Odyssey", "Star Wars", "Blade Runner", "The Matrix"], answer: 0 },
        { points: 300, q: "In 'Iron Man', what is the name of Tony Stark's original AI assistant?", options: ["J.A.R.V.I.S.", "F.R.I.D.A.Y.", "U.L.T.R.O.N.", "H.O.M.E.R."], answer: 0 },
        { points: 400, q: "What is the name of the AI villain in the 'Portal' game series?", options: ["GLaDOS", "Wheatley", "Shodan", "Cortana"], answer: 0 },
        { points: 500, q: "In the movie 'Her', who voices the AI operating system named Samantha?", options: ["Scarlett Johansson", "Jennifer Lawrence", "Emma Stone", "Mila Kunis"], answer: 0 }
    ]},
    'sci_fi': { name: 'Sci-Fi & Future', icon: 'fa-rocket', questions: [
        { points: 100, q: "What does 'AGI' stand for?", options: ["Artificial General Intelligence", "Automated Generated Image", "Advanced Game Interface", "Algorithmic Global Index"], answer: 0 },
        { points: 200, q: "Who wrote the 'Three Laws of Robotics'?", options: ["Isaac Asimov", "Arthur C. Clarke", "Philip K. Dick", "H.G. Wells"], answer: 0 },
        { points: 300, q: "What is the 'Singularity' in sci-fi terms?", options: ["The point where AI surpasses human intelligence", "A black hole event horizon", "A single line of code", "The first robot citizen"], answer: 0 },
        { points: 400, q: "In 'The Matrix', what are the agents?", options: ["Sentient programs", "Human traitors", "Robots in disguise", "Aliens"], answer: 0 },
        { points: 500, q: "Which author coined the term 'Cyberspace'?", options: ["William Gibson", "Neal Stephenson", "Bruce Sterling", "Orson Scott Card"], answer: 0 }
    ]},
    'hallucinations': { name: 'Hallucinations', icon: 'fa-bug', questions: [
        { points: 100, q: "What is an AI 'hallucination'?", options: ["Confidently stating false information", "Seeing ghosts in images", "Crashing due to overload", "Dreaming of electric sheep"], answer: 0 },
        { points: 200, q: "Why do LLMs sometimes struggle with math?", options: ["They predict tokens, not calculate", "They hate numbers", "They have small context windows", "They lack GPUs"], answer: 0 },
        { points: 300, q: "What is 'prompt injection'?", options: ["Tricking an AI to ignore its instructions", "Adding more memory to a prompt", "Optimizing a prompt for speed", "Deleting a prompt"], answer: 0 },
        { points: 400, q: "Which of these is a common issue with image generation models?", options: ["Extra fingers/limbs", "Too much color", "Perfect text rendering", "Overly sharp edges"], answer: 0 },
        { points: 500, q: "What is 'mode collapse' in GANs?", options: ["Generating the same output repeatedly", "The model crashing", "Forgetting old data", "Overfitting to noise"], answer: 0 }
    ]},
    'prompt_engineering': { name: 'Prompt Engineering', icon: 'fa-pen-fancy', questions: [
        { points: 100, q: "What is 'Chain of Thought' prompting?", options: ["Asking the model to explain its reasoning", "Writing a really long prompt", "Chaining multiple models together", "Repeating the same question"], answer: 0 },
        { points: 200, q: "What is 'Zero-shot' prompting?", options: ["Asking without examples", "Asking with zero context", "Asking a model with zero training", "A failed prompt"], answer: 0 },
        { points: 300, q: "What does 'Few-shot' prompting involve?", options: ["Providing a few examples in the prompt", "Asking a few questions", "Running the model a few times", "Using a small model"], answer: 0 },
        { points: 400, q: "What is a 'System Prompt'?", options: ["Initial instructions setting behavior", "A prompt for the operating system", "A hardware level command", "The final user query"], answer: 0 },
        { points: 500, q: "What is 'RAG' in the context of prompting?", options: ["Retrieval-Augmented Generation", "Random Access Generation", "Real-time AI Generation", "Recursive Algorithm Grouping"], answer: 0 }
    ]},
    'major_players': { name: 'Major Players', icon: 'fa-building', questions: [
        { points: 100, q: "Which company created ChatGPT?", options: ["OpenAI", "Google", "Microsoft", "Meta"], answer: 0 },
        { points: 200, q: "Who created the 'Claude' series of models?", options: ["Anthropic", "DeepMind", "Mistral", "Cohere"], answer: 0 },
        { points: 300, q: "Which company released the 'Llama' open weights models?", options: ["Meta", "Amazon", "Apple", "NVIDIA"], answer: 0 },
        { points: 400, q: "What is the name of Google's flagship model family?", options: ["Gemini", "Bard", "PaLM", "Bert"], answer: 0 },
        { points: 500, q: "Which of these is a French AI company?", options: ["Mistral", "Cohere", "Hugging Face", "DeepL"], answer: 0 }
    ]}
};

/**
 * SELF-CONTAINED AUDIO/SPEECH SYNTHESIZER
 */
class AudioSystem {
    constructor() {
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.synth = window.speechSynthesis;
        this.isMuted = false;
    }
    
    _playTone(freq, type, duration, vol = 0.1) {
        if(this.isMuted) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    }

    playClick() { this._playTone(800, 'sine', 0.1, 0.2); }
    playHover() { this._playTone(400, 'sine', 0.05, 0.1); }
    playScore() { 
        this._playTone(600, 'square', 0.1, 0.1);
        setTimeout(() => this._playTone(800, 'square', 0.15, 0.1), 100);
        setTimeout(() => this._playTone(1200, 'square', 0.2, 0.1), 200);
    }
    playError() {
        this._playTone(200, 'sawtooth', 0.3, 0.2);
        setTimeout(() => this._playTone(150, 'sawtooth', 0.4, 0.2), 150);
    }
    playTimeout() { this._playTone(300, 'triangle', 0.5, 0.3); }

    speak(text) {
        if(this.isMuted) return;
        this.synth.cancel(); // stop current speaking
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.pitch = 0.7; // Robotic pitch
        utterance.rate = 1.1;
        // Try to find a synthetic/robotic voice if available
        const voices = this.synth.getVoices();
        const botVoice = voices.find(v => v.name.toLowerCase().includes('google') || v.name.toLowerCase().includes('zira'));
        if(botVoice) utterance.voice = botVoice;
        this.synth.speak(utterance);
    }
    stopSpeaking() { this.synth.cancel(); }
}

/**
 * BACKGROUND ANIMATION SYSTEM
 */
class BackgroundSystem {
    constructor() {
        this.canvas = document.getElementById('bg-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.nodes = [];
        this.resize();
        window.addEventListener('resize', () => this.resize());
        this.initNodes();
        this.animate();
    }
    resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
    }
    initNodes() {
        this.nodes = [];
        const numNodes = Math.floor((window.innerWidth * window.innerHeight) / 15000);
        for(let i = 0; i < numNodes; i++) {
            this.nodes.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5,
                radius: Math.random() * 2 + 1
            });
        }
    }
    animate() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.fillStyle = 'rgba(14, 165, 233, 0.5)';
        this.ctx.strokeStyle = 'rgba(14, 165, 233, 0.15)';
        
        for(let i=0; i<this.nodes.length; i++) {
            let n = this.nodes[i];
            n.x += n.vx; n.y += n.vy;
            if(n.x < 0 || n.x > this.canvas.width) n.vx *= -1;
            if(n.y < 0 || n.y > this.canvas.height) n.vy *= -1;
            
            this.ctx.beginPath();
            this.ctx.arc(n.x, n.y, n.radius, 0, Math.PI * 2);
            this.ctx.fill();

            for(let j=i+1; j<this.nodes.length; j++) {
                let n2 = this.nodes[j];
                let dist = Math.hypot(n.x - n2.x, n.y - n2.y);
                if(dist < 150) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(n.x, n.y);
                    this.ctx.lineTo(n2.x, n2.y);
                    this.ctx.stroke();
                }
            }
        }
        requestAnimationFrame(() => this.animate());
    }
}

/**
 * MAIN GAME LOGIC
 */
class GameApp {
    constructor() {
        this.mount = document.getElementById('game-mount');
        this.audio = new AudioSystem();
        
        // Profiles
        this.player = { name: "Human", seed: "human_123", style: "avataaars", avatarUrl: "" };
        this.bot = { name: "Host_Bot_v2", seed: "host_bot_99", style: "bottts", avatarUrl: "" };

        // State
        this.allCategories = Object.keys(CHATBOT_TRIVIA_DATA);
        this.selectedCategories = [];
        this.categories = [];
        this.boardState = {};
        this.score = 0;
        this.totalQuestions = 0;
        this.questionsAnswered = 0;
        this.correctAnswers = 0;
        
        // Timers
        this.timerInterval = null;
        this.timer = 0;
        this.maxTime = 20;

        this.updateAvatarUrls();
        this.renderSetup();
    }

    updateAvatarUrls() {
        // Using DiceBear for AI-generated customized avatars based on seed
        this.player.avatarUrl = `https://api.dicebear.com/7.x/${this.player.style}/svg?seed=${this.player.name}`;
        this.bot.avatarUrl = `https://api.dicebear.com/7.x/${this.bot.style}/svg?seed=${this.bot.seed}`;
    }

    renderSetup() {
        this.mount.innerHTML = `
            <div class="flex-1 flex items-center justify-center p-4">
                <div class="glass-panel p-8 rounded-2xl w-full max-w-3xl text-center">
                    <h1 class="text-4xl orbitron text-cyan-400 mb-2">INITIALIZE PROFILES</h1>
                    <p class="text-slate-400 mb-8">Customize your biological entity representation</p>
                    
                    <div class="flex flex-col md:flex-row gap-8 items-center justify-center mb-8">
                        <!-- Player Setup -->
                        <div class="flex flex-col items-center bg-slate-800/50 p-6 rounded-xl border border-slate-700 w-full md:w-1/2">
                            <h3 class="text-xl text-white mb-4">PLAYER ENTITY</h3>
                            <img id="preview-player" src="${this.player.avatarUrl}" class="w-32 h-32 rounded-full bg-slate-900 border-4 border-cyan-500 mb-4 floating">
                            <input type="text" id="player-name" value="${this.player.name}" class="w-full bg-slate-900 border border-cyan-500 rounded p-2 text-white text-center mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="Enter Name">
                            <select id="player-style" class="w-full bg-slate-900 border border-cyan-500 rounded p-2 text-white text-center focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="avataaars" ${this.player.style==='avataaars'?'selected':''}>Humanoid 1</option>
                                <option value="micah" ${this.player.style==='micah'?'selected':''}>Humanoid 2</option>
                                <option value="pixel-art" ${this.player.style==='pixel-art'?'selected':''}>Retro Pixel</option>
                                <option value="bottts" ${this.player.style==='bottts'?'selected':''}>Cyborg</option>
                            </select>
                        </div>

                        <div class="text-4xl text-cyan-500 font-bold orbitron">VS</div>

                        <!-- Bot Setup -->
                        <div class="flex flex-col items-center bg-slate-800/50 p-6 rounded-xl border border-slate-700 w-full md:w-1/2">
                            <h3 class="text-xl text-white mb-4">HOST SYSTEM</h3>
                            <img src="${this.bot.avatarUrl}" class="w-32 h-32 rounded-full bg-slate-900 border-4 border-purple-500 mb-4 floating" style="animation-delay: -1.5s;">
                            <div class="w-full bg-slate-900 border border-purple-500 rounded p-2 text-purple-300 text-center mb-4 cursor-not-allowed opacity-70">${this.bot.name}</div>
                            <div class="w-full bg-slate-900 border border-purple-500 rounded p-2 text-purple-300 text-center cursor-not-allowed opacity-70">Style: Bottts</div>
                        </div>
                    </div>

                    <button id="btn-start" class="btn-cyber px-12 py-4 rounded-full text-xl font-bold w-full md:w-auto">
                        <i class="fas fa-power-off mr-2"></i> BOOT SEQUENCE
                    </button>
                </div>
            </div>
        `;

        const nameInput = document.getElementById('player-name');
        const styleSelect = document.getElementById('player-style');
        const preview = document.getElementById('preview-player');

        const updatePreview = () => {
            this.player.name = nameInput.value || "Anonymous";
            this.player.style = styleSelect.value;
            this.updateAvatarUrls();
            preview.src = this.player.avatarUrl;
        };

        nameInput.addEventListener('input', updatePreview);
        styleSelect.addEventListener('change', updatePreview);

        document.getElementById('btn-start').onclick = () => {
            // Must initialize AudioContext on user interaction
            if(this.audio.ctx.state === 'suspended') this.audio.ctx.resume();
            this.audio.playClick();
            this.renderMenu();
        };
    }

    renderMenu() {
        this.mount.innerHTML = `
            <div class="flex-1 flex flex-col items-center justify-center text-center p-8 z-20">
                <img src="${this.bot.avatarUrl}" class="w-40 h-40 mb-6 drop-shadow-[0_0_20px_rgba(168,85,247,0.6)] floating">
                <h1 class="text-5xl md:text-7xl orbitron font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 mb-2 drop-shadow-lg">
                    ARE YOU SMARTER
                </h1>
                <h2 class="text-3xl md:text-5xl font-bold text-white mb-8 tracking-widest">
                    THAN A CHATBOT?
                </h2>
                <p class="text-slate-400 mb-12 max-w-lg text-lg">
                    Challenge your knowledge on AI, LLMs, and the Singularity. Prove you are not just training data.
                </p>
                <button id="btn-select-cat" class="btn-cyber px-10 py-5 rounded-full text-2xl font-bold shadow-[0_0_20px_rgba(8,145,178,0.5)]">
                    INITIATE CHALLENGE
                </button>
            </div>
        `;

        document.getElementById('btn-select-cat').onclick = () => {
            this.audio.playClick();
            this.audio.speak(`Welcome, ${this.player.name}. Select your knowledge domains.`);
            this.renderCategorySelection();
        };
    }

    renderCategorySelection() {
        this.mount.innerHTML = `
            <div class="w-full text-center py-6 z-20 glass-panel border-x-0 border-t-0">
                <h2 class="text-3xl font-bold text-cyan-400 mb-2 orbitron">SELECT 5 CATEGORIES</h2>
                <p id="selection-count" class="text-slate-400">Selected: ${this.selectedCategories.length} / 5</p>
            </div>
            <div class="flex-1 flex flex-col items-center justify-center z-20 w-full p-4 overflow-hidden">
                <div class="cat-select-grid" id="cat-grid"></div>
                <div class="flex gap-4 mt-6">
                    <button id="btn-random" class="btn-cyber !bg-gradient-to-r !from-purple-600 !to-pink-600 !border-purple-400 px-6 py-3 rounded-lg shadow-lg">
                        <i class="fas fa-dice mr-2"></i> RANDOMIZE
                    </button>
                    <button id="btn-play" class="btn-cyber px-8 py-3 rounded-lg shadow-lg" ${this.selectedCategories.length !== 5 ? 'disabled' : ''}>
                        START GAME <i class="fas fa-play ml-2"></i>
                    </button>
                </div>
            </div>
        `;

        const grid = document.getElementById('cat-grid');
        this.allCategories.forEach(key => {
            const cat = CHATBOT_TRIVIA_DATA[key];
            const isSelected = this.selectedCategories.includes(key);
            const card = document.createElement('div');
            card.className = `cat-card ${isSelected ? 'selected' : ''}`;
            card.innerHTML = `
                <div class="check-icon"><i class="fas fa-check-circle"></i></div>
                <i class="fas ${cat.icon}"></i>
                <h4 class="font-bold text-sm text-slate-200">${cat.name}</h4>
            `;
            card.onclick = () => {
                if (this.selectedCategories.includes(key)) {
                    this.selectedCategories = this.selectedCategories.filter(k => k !== key);
                    card.classList.remove('selected');
                    this.audio.playHover();
                } else if (this.selectedCategories.length < 5) {
                    this.selectedCategories.push(key);
                    card.classList.add('selected');
                    this.audio.playHover();
                } else {
                    this.audio.playError();
                }
                document.getElementById('selection-count').textContent = `Selected: ${this.selectedCategories.length} / 5`;
                document.getElementById('btn-play').disabled = this.selectedCategories.length !== 5;
            };
            grid.appendChild(card);
        });

        document.getElementById('btn-random').onclick = () => {
            this.audio.playClick();
            const shuffled = [...this.allCategories].sort(() => 0.5 - Math.random());
            this.selectedCategories = shuffled.slice(0, 5);
            this.renderCategorySelection();
        };

        document.getElementById('btn-play').onclick = () => {
            this.audio.playClick();
            this.audio.speak("Loading simulation.");
            this.prepareGameData();
            this.renderBoard();
        };
    }

    prepareGameData() {
        this.categories = this.selectedCategories.map(key => ({
            id: key, ...CHATBOT_TRIVIA_DATA[key]
        }));
        this.boardState = {};
        this.score = 0;
        this.questionsAnswered = 0;
        this.correctAnswers = 0;
        this.totalQuestions = this.categories.length * 5;
    }

    renderBoard() {
        let gridHtml = '';
        
        // Headers
        this.categories.forEach(cat => {
            gridHtml += `<div class="cat-header"><i class="fas ${cat.icon} text-2xl mb-1"></i><span>${cat.name.toUpperCase()}</span></div>`;
        });

        // Rows (100 to 500)
        for (let i = 0; i < 5; i++) {
            this.categories.forEach((cat, catIndex) => {
                const qKey = `${catIndex}-${i}`;
                const points = cat.questions[i].points;
                const isUsed = this.boardState[qKey];
                
                if (isUsed) {
                    gridHtml += `<button class="point-btn" disabled></button>`;
                } else {
                    gridHtml += `<button class="point-btn" data-cat="${catIndex}" data-q="${i}">${points}</button>`;
                }
            });
        }

        this.mount.innerHTML = `
            <div class="w-full flex justify-between items-center px-8 py-3 glass-panel border-x-0 border-t-0 z-20">
                <div class="flex items-center gap-4">
                    <img src="${this.player.avatarUrl}" class="w-10 h-10 rounded-full bg-slate-800 border-2 border-cyan-500">
                    <span class="text-xl font-bold text-cyan-400 orbitron">${this.player.name.toUpperCase()}</span>
                </div>
                <div class="text-3xl font-bold text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]">
                    SCORE: <span id="board-score">${this.score}</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-xl font-bold text-purple-400 orbitron">${this.bot.name.toUpperCase()}</span>
                    <img src="${this.bot.avatarUrl}" class="w-10 h-10 rounded-full bg-slate-800 border-2 border-purple-500">
                </div>
            </div>
            <div class="flex-1 flex items-center justify-center z-20 p-4 w-full overflow-auto">
                <div class="chatbot-grid">${gridHtml}</div>
            </div>
        `;

        this.mount.querySelectorAll('.point-btn:not([disabled])').forEach(btn => {
            btn.onclick = () => {
                const cIdx = parseInt(btn.dataset.cat);
                const qIdx = parseInt(btn.dataset.q);
                this.selectQuestion(cIdx, qIdx);
            };
        });
    }

    selectQuestion(catIndex, qIndex) {
        this.audio.playClick();
        const qKey = `${catIndex}-${qIndex}`;
        this.boardState[qKey] = true;
        this.currentQuestion = {
            ...this.categories[catIndex].questions[qIndex],
            catName: this.categories[catIndex].name,
            key: qKey
        };
        this.renderQuestion();
    }

    renderQuestion() {
        const q = this.currentQuestion;
        this.timer = this.maxTime;
        
        // Shuffle options
        const opts = q.options.map((text, i) => ({ text, originalIndex: i }));
        this.shuffledOptions = opts.sort(() => Math.random() - 0.5);

        this.mount.innerHTML = `
            <div class="w-full max-w-4xl mx-auto p-6 flex flex-col h-full justify-center z-20 relative">
                <div class="flex justify-between items-end mb-4 text-cyan-400">
                    <span class="text-xl font-bold orbitron">${q.catName.toUpperCase()} // ${q.points} PTS</span>
                    <span class="text-4xl font-bold text-white orbitron" id="timer-display">${this.timer}</span>
                </div>

                <div class="w-full h-4 bg-slate-800 rounded-full mb-8 overflow-hidden border border-slate-600">
                    <div id="timer-bar" class="h-full bg-cyan-500 w-full transition-all duration-100 ease-linear shadow-[0_0_10px_rgba(34,211,238,0.5)]"></div>
                </div>

                <div class="glass-panel p-8 rounded-xl mb-8 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-cyan-400 group-hover:scale-110 transition-transform duration-1000">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-bold text-center leading-relaxed text-white drop-shadow-md">${q.q}</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="options-container">
                    ${this.shuffledOptions.map((opt, idx) => `
                        <button class="option-btn w-full p-6 text-left rounded-xl bg-slate-800 border-2 border-slate-600 hover:border-cyan-400 hover:bg-slate-700 transition-all font-bold text-lg text-slate-200 flex items-center group relative overflow-hidden" data-idx="${idx}">
                            <span class="w-10 h-10 rounded bg-slate-700 text-cyan-400 flex items-center justify-center mr-4 text-xl border border-slate-600 group-hover:border-cyan-400 transition-colors">${String.fromCharCode(65+idx)}</span>
                            ${opt.text}
                        </button>
                    `).join('')}
                </div>
                
                <div id="feedback-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
                     <div id="feedback-card" class="glass-panel px-10 py-6 rounded-2xl text-center transform scale-50 transition-transform duration-500">
                         <div id="feedback-icon" class="text-6xl mb-2"></div>
                         <div id="feedback-text" class="text-2xl font-bold mb-2"></div>
                         <div id="feedback-points" class="text-xl text-yellow-400 orbitron"></div>
                     </div>
                </div>
            </div>
        `;

        this.mount.querySelectorAll('.option-btn').forEach(btn => {
            btn.onclick = () => this.handleAnswer(parseInt(btn.dataset.idx));
        });

        // Start Timer
        clearInterval(this.timerInterval);
        this.timerInterval = setInterval(() => {
            this.timer -= 0.1;
            if (this.timer <= 0) {
                this.timer = 0;
                clearInterval(this.timerInterval);
                this.handleAnswer(-1); // Timeout
            }
            this.updateTimerUI();
        }, 100);
    }

    updateTimerUI() {
        const bar = document.getElementById('timer-bar');
        const display = document.getElementById('timer-display');
        if (!bar || !display) return;

        const pct = (this.timer / this.maxTime) * 100;
        bar.style.width = `${pct}%`;
        display.textContent = Math.ceil(this.timer);

        if (pct < 25) {
            bar.classList.replace('bg-cyan-500', 'bg-red-500');
            bar.classList.replace('shadow-[0_0_10px_rgba(34,211,238,0.5)]', 'shadow-[0_0_15px_rgba(239,68,68,0.8)]');
            display.classList.add('text-red-500');
        }
    }

    handleAnswer(selectedIndex) {
        clearInterval(this.timerInterval);
        
        // Prevent double clicks
        const btns = this.mount.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);
        
        this.questionsAnswered++;
        const isTimeout = selectedIndex === -1;
        const selectedOption = isTimeout ? null : this.shuffledOptions[selectedIndex];
        const isCorrect = !isTimeout && selectedOption.originalIndex === this.currentQuestion.answer;
        const correctBtnIndex = this.shuffledOptions.findIndex(o => o.originalIndex === this.currentQuestion.answer);

        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackCard = document.getElementById('feedback-card');
        const fIcon = document.getElementById('feedback-icon');
        const fText = document.getElementById('feedback-text');
        const fPoints = document.getElementById('feedback-points');

        feedbackOverlay.classList.remove('opacity-0');
        feedbackCard.classList.remove('scale-50');
        feedbackCard.classList.add('scale-100');

        if (isCorrect) {
            btns[selectedIndex].classList.add('bg-green-800', 'border-green-500');
            
            // Calculate Time Bonus
            const timeBonus = Math.floor(this.timer * 5);
            const totalEarned = this.currentQuestion.points + timeBonus;
            this.score += totalEarned;
            this.correctAnswers++;
            
            this.audio.playScore();
            fIcon.innerHTML = '<i class="fas fa-check-circle text-green-400"></i>';
            fText.innerHTML = '<span class="text-green-400">CORRECT</span>';
            fPoints.innerHTML = `+${this.currentQuestion.points} Base <br> <span class="text-sm text-cyan-300">+${timeBonus} Time Bonus</span>`;
            
            const comments = ["Data verified.", "Processing... Valid.", "Not bad for a biological entity."];
            this.audio.speak(comments[Math.floor(Math.random() * comments.length)]);
        } else {
            // Highlight Correct
            if(btns[correctBtnIndex]) btns[correctBtnIndex].classList.add('bg-green-900', 'border-green-600', 'opacity-80');
            
            if (isTimeout) {
                this.audio.playTimeout();
                fIcon.innerHTML = '<i class="fas fa-clock text-red-500"></i>';
                fText.innerHTML = '<span class="text-red-500">TIME LIMIT EXCEEDED</span>';
                this.audio.speak("Time limit exceeded.");
            } else {
                btns[selectedIndex].classList.add('bg-red-900', 'border-red-500');
                this.audio.playError();
                fIcon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                fText.innerHTML = '<span class="text-red-500">INCORRECT</span>';
                
                const comments = ["Hallucination detected.", "Error. Logic flaw.", "Try upgrading your neural net."];
                this.audio.speak(comments[Math.floor(Math.random() * comments.length)]);
            }
        }

        setTimeout(() => {
            if (this.questionsAnswered >= this.totalQuestions) {
                this.renderGameOver();
            } else {
                this.renderBoard();
            }
        }, 3000);
    }

    renderGameOver() {
        const accuracy = this.totalQuestions > 0 ? (this.correctAnswers / this.totalQuestions) * 100 : 0;
        let title, awardName, awardColor, awardSvg;

        if (accuracy >= 90) {
            title = "Superintelligence"; awardName = "Gold Neural Matrix"; awardColor = "text-yellow-400";
            awardSvg = `<svg class="w-32 h-32 mx-auto drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: #facc15;"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>`;
        } else if (accuracy >= 70) {
            title = "AGI Prototype"; awardName = "Silver Logic Core"; awardColor = "text-slate-300";
            awardSvg = `<svg class="w-32 h-32 mx-auto drop-shadow-[0_0_20px_rgba(203,213,225,0.8)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: #cbd5e1;"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>`;
        } else if (accuracy >= 40) {
            title = "Prompt Engineer"; awardName = "Bronze Syntax Medal"; awardColor = "text-orange-400";
            awardSvg = `<svg class="w-32 h-32 mx-auto drop-shadow-[0_0_20px_rgba(251,146,60,0.8)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: #fb923c;"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>`;
        } else {
            title = "Hallucinating Model"; awardName = "Broken Floppy Disk"; awardColor = "text-red-500";
            awardSvg = `<svg class="w-32 h-32 mx-auto drop-shadow-[0_0_20px_rgba(239,68,68,0.8)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: #ef4444;"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`;
        }

        this.mount.innerHTML = `
            <div class="flex-1 flex flex-col items-center justify-center p-8 z-20 overflow-y-auto">
                <div class="glass-panel p-10 rounded-2xl w-full max-w-4xl text-center border-t-4 border-t-cyan-500">
                    <h2 class="text-5xl font-bold text-white mb-2 orbitron">ASSESSMENT COMPLETE</h2>
                    <div class="text-2xl text-cyan-400 mb-8 font-mono">CLASSIFICATION: <span class="text-white font-bold border-b-2 border-cyan-500 pb-1">${title}</span></div>

                    <div class="flex flex-col md:flex-row gap-8 justify-center items-center mb-8">
                        
                        <!-- Player Stats -->
                        <div class="bg-slate-800/80 p-6 rounded-xl border border-slate-700 w-full md:w-1/2 shadow-inner">
                            <img src="${this.player.avatarUrl}" class="w-24 h-24 mx-auto rounded-full bg-slate-900 border-2 border-cyan-500 mb-4">
                            <h3 class="text-xl text-cyan-300 mb-4 orbitron">${this.player.name}</h3>
                            <div class="grid grid-cols-2 gap-4 text-lg">
                                <div class="text-right text-slate-400">Total Score:</div>
                                <div class="text-left font-bold text-yellow-400">${this.score}</div>
                                <div class="text-right text-slate-400">Accuracy:</div>
                                <div class="text-left font-bold text-white">${accuracy.toFixed(1)}%</div>
                                <div class="text-right text-slate-400">Correct:</div>
                                <div class="text-left font-bold text-green-400">${this.correctAnswers} / ${this.totalQuestions}</div>
                            </div>
                        </div>

                        <!-- Award Section -->
                        <div class="bg-slate-800/80 p-6 rounded-xl border border-slate-700 w-full md:w-1/2 flex flex-col justify-center shadow-inner min-h-[300px]">
                            <h3 class="text-xl text-slate-300 mb-4 orbitron">ACQUIRED ASSET</h3>
                            <div class="mb-4 floating">
                                ${awardSvg}
                            </div>
                            <div class="text-2xl font-bold ${awardColor} orbitron tracking-wider">${awardName}</div>
                            <p class="text-sm text-slate-400 mt-2">Added to inventory.</p>
                        </div>

                    </div>

                    <div class="flex justify-center gap-6 mt-4">
                        <button id="btn-replay" class="btn-cyber px-8 py-3 rounded-full text-xl shadow-lg">
                            <i class="fas fa-redo mr-2"></i> NEW SESSION
                        </button>
                    </div>
                </div>
            </div>
        `;

        // Speak Result
        setTimeout(() => {
            this.audio.speak(`Analysis complete. Biological entity ${this.player.name} is rated as: ${title}.`);
        }, 500);

        document.getElementById('btn-replay').onclick = () => {
            this.audio.playClick();
            this.selectedCategories = [];
            this.renderCategorySelection();
        };
    }
}

// Initialization
window.onload = () => {
    // Start background animation
    new BackgroundSystem();
    // Start Game logic
    new GameApp();
};

</script>
</body>
</html>
